create table produtos (
	id_produto serial not null primary key,
	nome_produto varchar(255) not null,
	valor decimal(6, 2) not null
);

create table vendas (
	id_venda serial not null primary key,
	quantidade_produtos int not null,
	valor_total decimal(7,2) not null,
	produto_id int not null references produtos(id_produto)
);

insert into produtos (nome_produto, valor)
values ('caderno', 25.00),
	('lapis', 1.00),
	('borracha', 0.5),
	('estojo', 10.00),
	('caneta', 5.00),
	('marca-texto', 6.00),
	('lapis de cor', 12.00),
	('post-it', 5.00),
	('giz de cera', 10.00);
	
DO $$ -- iniciando um bloco de comandos
DECLARE -- declaração das variaveis
	quantidade int := 100;
	valor decimal := 200.00;
	valor_total decimal;
	vendedor VARCHAR(100) := 'William';
	
BEGIN -- iniciar as ações
	valor_total := quantidade * valor;
	
	RAISE NOTICE 'O vendedor de nome "%" vendeu um total de % reais em produto.', vendedor, valor_total;-- para printar

END $$; -- fim do bloco

-- Quantos produtos tem o valor acima da média

SELECT AVG(valor) FROM produtos;
SELECT COUNT(*) FROM produtos
WHERE valor > 8.2777778;

SELECT COUNT(*) FROM produtos
WHERE valor > (SELECT AVG(valor) FROM produtos)

do $$
declare
	media decimal;
	quantidade int;
	
begin
	media := (SELECT AVG(valor) FROM produtos);
	quantidade := (SELECT COUNT(*) FROM produtos WHERE valor > media);
	
	raise notice 'A quantidade de valores acima da media é %.', quantidade;
end $$;

-- Como inserir a venda de dois cadernos?

INSERT INTO vendas (quantidade_produtos, valor_total, produto_id)
VALUES (2, 50, 1);

do $$
declare
	quantidade int := 2;
	valor decimal;
	valor_total decimal;
	
begin
	valor := (SELECT valor FROM produtos WHERE (id_produto = 1)
	valor_total := quantidade * valor	

	INSERT INTO vendas (quantidade_produto, valor_total, produto)
	VALUES (quatidade, vaor_total, produto)

end $$;
